<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="com.sos.scheduler.build" basedir=".">

  <taskdef resource="net/sf/antcontrib/antcontrib.properties" classpath="${env.USERPROFILE}/.m2/repository/ant-contrib/ant-contrib/1.0b3/ant-contrib-1.0b3.jar"/>
  
  <propertyregex property="base" override="true" global="true" input="${basedir}" regexp="\\" replace="/" defaultValue="${basedir}" />  
  <property name="source.root"        value="${base}/src/main" />
  <property name="script.root"        value="${source.root}/scripts" />
  <property name="perl.keywordtoxml"  value="${script.root}/scheduler_keyword_to_xml.pl" />
  <property name="script.keywordtoxml"  value="${script.root}/scheduler_keyword_to_xml" />
  <property name="generated.dir" value="${basedir}/target/generated" />

  <property name="output.r" value="register_data.xml"/>

  <target name="all" depends="-prepare, -keywords.to.register_data.win, -keywords.to.register_data.ux, -copy.files">
    <echo>DONE!</echo>
  </target>

  <target name="-prepare" description="prepare the build">
    <echo>base=${basedir}</echo>
    <mkdir dir="${generated.dir}" />
  </target>

  <target name="-copy.files" description="copy the generated files to the resources folder">
    <copy verbose="true" file="${generated.dir}/${output.r}" tofile="${source.root}/resources/doc/${output.r}" />
    <copy verbose="true" file="${generated.dir}/${output.r}" tofile="${source.root}/resources/doc.en/${output.r}" />
  </target>

  <target name="-keywords.to.register_data.win" depends="-check.os" if="isWindows" description="generates register_data.xml">
    <echo>generating register-data.xml ...</echo>
    <propertyregex property="script.cygwin" override="true" global="true" input="${script.root}/scheduler_keyword_to_xml" regexp="^(.):(.*)" replace="/cygdrive/\1\2" />
    <echo>cygbase=${script.cygwin}</echo>
    <exec executable="bash" dir="${script.root}" output="${generated.dir}/${output.r}" logError="false">
      <arg value="-c" />
      <arg value="&quot;" />
      <arg value="${script.cygwin}" />
      <arg value="&quot;" />
    </exec>
  </target>

  <target name="-keywords.to.register_data.ux" depends="-check.os" if="isLinux" description="generates register_data.xml">
    <echo>generating register-data.xml ...</echo>
    <exec executable="${script.keywordtoxml}" dir="${script.root}" output="${generated.dir}/${output.r}" />
  </target>
  
  <target name="-check.os">
  	<condition property="isWindows">
  		<os family="windows" />
  	</condition>
  
  	<condition property="isLinux">
  		<os family="unix" />
  	</condition>
  </target>

</project>